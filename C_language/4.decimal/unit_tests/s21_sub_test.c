#include <check.h>
#include <float.h>
#include <math.h>
#include <stdio.h>
#include <string.h>

#include "../s21_decimal.h"
static s21_decimal dst[] = {
    {{0x00000001, 0x00000000, 0x00000000, 0x00000000}},  // 1
    {{0x000000FF, 0x00000000, 0x00000000, 0x00000000}},  // 255
    {{0xFFFFFFFF, 0xFFFFFFFF, 0x00000000, 0x00000000}},  // 18446744073709551615
    {{0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF,
      0x00000000}},  // 79228162514264337593543950335
};
static char *sub_res[] = {"+0.0000000000000000000000000000",
                          "-0.0000000000000000000000000254",
                          "-0.0000000018446744073709551614",
                          "-7.9228162514264337593543950334",
                          "-0.9999999999999999999999999999",
                          "-255.00000000000000000000000000",
                          "-18446744073709551615.000000000",
                          "-79228162514264337593543950335",
                          "+0.0000000000000000000000000254",
                          "+0.0000000000000000000000000000",
                          "-0.0000000018446744073709551360",
                          "-7.9228162514264337593543950080",
                          "-0.9999999999999999999999999745",
                          "-254.99999999999999999999999997",
                          "-18446744073709551615.000000000",
                          "-79228162514264337593543950335",
                          "+0.0000000018446744073709551614",
                          "+0.0000000018446744073709551360",
                          "+0.0000000000000000000000000000",
                          "-7.9228162495817593519834398720",
                          "-0.9999999981553255926290448385",
                          "-254.99999999815532559262904484",
                          "-18446744073709551614.999999998",
                          "-79228162514264337593543950335",
                          "+7.9228162514264337593543950334",
                          "+7.9228162514264337593543950080",
                          "+7.9228162495817593519834398720",
                          "+0.0000000000000000000000000000",
                          "+6.9228162514264337593543950335",
                          "-247.07718374857356624064560497",
                          "-18446744073709551607.077183748",
                          "-79228162514264337593543950327",
                          "+0.9999999999999999999999999999",
                          "+0.9999999999999999999999999745",
                          "+0.9999999981553255926290448385",
                          "-6.9228162514264337593543950335",
                          "+0.0000000000000000000000000000",
                          "-254",
                          "-18446744073709551614",
                          "-79228162514264337593543950334",
                          "+255.00000000000000000000000000",
                          "+254.99999999999999999999999997",
                          "+254.99999999815532559262904484",
                          "+247.07718374857356624064560497",
                          "+254",
                          "+0.0000000000000000000000000000",
                          "-18446744073709551360",
                          "-79228162514264337593543950080",
                          "+18446744073709551615.000000000",
                          "+18446744073709551615.000000000",
                          "+18446744073709551614.999999998",
                          "+18446744073709551607.077183748",
                          "+18446744073709551614",
                          "+18446744073709551360",
                          "+0.0000000000000000000000000000",
                          "-79228162495817593519834398720",
                          "+79228162514264337593543950335",
                          "+79228162514264337593543950335",
                          "+79228162514264337593543950335",
                          "+79228162514264337593543950327",
                          "+79228162514264337593543950334",
                          "+79228162514264337593543950080",
                          "+79228162495817593519834398720",
                          "+0.0000000000000000000000000000"};

START_TEST(test_sub) {
  s21_decimal dec1 = {0}, dec2 = {0};
  int index = 0;
  for (int x = 1; x >= 0; x--)
    for (size_t i = 0; i < 4; i++) {
      for (int t = 0; t < 4; t++) dec1.bits[t] = dst[i].bits[t];
      if (x) {
        _S_D_(dec1, 28);
      } else {
        _S_D_(dec1, 0);
      }
      for (int y = 1; y >= 0; y--)
        for (size_t j = 0; j < 4; j++) {
          for (int t = 0; t < 4; t++) dec2.bits[t] = dst[j].bits[t];
          if (y) {
            _S_D_(dec2, 28);
          } else {
            _S_D_(dec2, 0);
          }
          s21_decimal res = {0};
          int result = s21_sub(dec1, dec2, &res);
          char str_res[100] = {0};
          get_formatted_str_decimal(res, str_res);
          if (!result) {
            ck_assert_pstr_eq(str_res, sub_res[index]);
          }
          index++;
        }
    }
}

Suite *suite_sub_test(void) {
  Suite *s;
  TCase *tc;

  s = suite_create("s21_sub");
  tc = tcase_create("s21_sub");

  if (s != NULL && tc != NULL) {
    tcase_add_test(tc, test_sub);
    //   tcase_add_test(tc, test1);
    suite_add_tcase(s, tc);
  }

  return (s);
}